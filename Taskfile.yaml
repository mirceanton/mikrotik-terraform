---
version: 3

env:
  SOPS_AGE_KEY_FILE: age.key

tasks:
  sops:decrypt:
    desc: Decrypt the terraform state and vars files.
    aliases: [ "sops:dec", "sops:d" ]
    dir: "{{.TASKFILE_DIR}}"
    cmds:
      - sops --decrypt tfstate.sops.json > tfstate.json
      - sops --decrypt infrastructure/credentials.auto.tfvars.sops > infrastructure/credentials.auto.tfvars

  sops:encrypt:
    desc: Encrypt the terraform state and vars files.
    aliases: [ "sops:enc", "sops:e" ]
    dir: "{{.TASKFILE_DIR}}"
    cmds:
      - sops --encrypt tfstate.json > tfstate.sops.json
      - sops --encrypt infrastructure/credentials.auto.tfvars > infrastructure/credentials.auto.tfvars.sops
