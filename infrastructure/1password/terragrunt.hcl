include "root" {
  path = find_in_parent_folders("root.hcl")
}

dependency "capsman" {
  config_path = find_in_parent_folders("mikrotik/router-rb5009/services/capsman")
}

dependency "switch-crs326" {
  config_path = find_in_parent_folders("mikrotik/switch-crs326")
}

dependency "switch-hex" {
  config_path = find_in_parent_folders("mikrotik/switch-hex")
}

dependency "switch-crs317" {
  config_path = find_in_parent_folders("mikrotik/switch-crs317")
}

dependency "router-rb5009" {
  config_path = find_in_parent_folders("mikrotik/router-rb5009")
}

terraform {
  source = find_in_parent_folders("modules/1password-item")
}

inputs = {
  items = merge(
    {
      "WiFi - Badoink 5Ghz" = {
        vault    = "Badoink"
        category = "password"
        password = dependency.capsman.outputs.wifi_passphrases["home-5ghz"]
        notes    = "Auto-generated by Terraform"
      }
      "WiFi - Badoink 2Ghz" = {
        vault    = "Badoink"
        category = "password"
        password = dependency.capsman.outputs.wifi_passphrases["home-2ghz"]
        notes    = "Auto-generated by Terraform"
      }

      "WiFi - Guest" = {
        vault    = "Badoink"
        category = "password"
        password = dependency.capsman.outputs.wifi_passphrases["guest"]
        notes    = "Auto-generated by Terraform"
      }
    },

    {
      for user, pass in dependency.switch-crs326.outputs.user_passwords :
      "CRS326 - ${user}" => {
        vault    = "Automation"
        category = "login"
        username = user
        password = pass
        notes    = "Generated by Terraform for Mikrotik CRS326 device"
      }
    },
    {
      for user, pass in dependency.switch-hex.outputs.user_passwords :
      "HEX - ${user}" => {
        vault    = "Automation"
        category = "login"
        username = user
        password = pass
        notes    = "Generated by Terraform for Mikrotik HEX device"
      }
    },
    {
      for user, pass in dependency.switch-crs317.outputs.user_passwords :
      "CRS317 - ${user}" => {
        vault    = "Automation"
        category = "login"
        username = user
        password = pass
        notes    = "Generated by Terraform for Mikrotik CRS317 device"
      }
    },
    {
      for user, pass in dependency.router-rb5009.outputs.user_passwords :
      "RB5009 - ${user}" => {
        vault    = "Automation"
        category = "login"
        username = user
        password = pass
        notes    = "Generated by Terraform for Mikrotik RB5009 device"
      }
    }
  )
}
